<!doctype html>
<html lang="en">
<head>
  <title>The game</title>
  <meta charset="utf-8">
</head>
<body style="margin: 0;padding: 30px;">

  <script src="js/three.min.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script src="js/THREEx.KeyboardState.js"></script>

  <script>

    // Set up the scene, camera, and renderer as global variables.
    var scene, camera, renderer,car;
    var keyboard = new THREEx.KeyboardState();
    var angle=0;
    var speed=0;

    init();
    animate();

    // Sets up the scene.
    function init() {

      // Create the scene and set the scene size.
      scene = new THREE.Scene();
      var WIDTH = window.innerWidth-100,
          HEIGHT = window.innerHeight-100;

      // Create a renderer and add it to the DOM.
      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(WIDTH, HEIGHT);
      document.body.appendChild(renderer.domElement);

      // Create a camera, zoom it out from the model a bit, and add it to the scene.
      camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
      camera.position.set(0,10,-20);
      scene.add(camera);

      // Create an event listener that resizes the renderer with the browser window.
      window.addEventListener('resize', function() {
        var WIDTH = window.innerWidth,
            HEIGHT = window.innerHeight;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
      });

      // Set the background color of the scene.
      renderer.setClearColorHex(0x333F47, 1);

      // Create a light, set its position, and add it to the scene.
      var light = new THREE.PointLight(0xffffff);
      light.position.set(-100,200,100);
      scene.add(light);
      
      //Create the ground
      var groundGeo = new THREE.PlaneGeometry(400,400);
      var groundMat = new THREE.MeshLambertMaterial( { color: 0xffffff, opacity: 1.0, transparent: false } ); 
      var ground = new THREE.Mesh(groundGeo,groundMat);
      ground.position.y = -0.5; //lower it
      ground.rotation.x = -Math.PI/2; //-90 degrees around the xaxis
      //IMPORTANT, draw on both sides
      ground.doubleSided = true;
      scene.add(ground);
      
      // Load in the mesh and add it to the scene.
      var loader = new THREE.JSONLoader();
      loader.load( "models/911.js", function(geometry){
        //var material = new THREE.MeshLambertMaterial({color: 0x1111FF});
        var material = new THREE.MeshLambertMaterial( { color: 0x995500, opacity: 1.0, transparent: false } ); 
        mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);
        car=mesh;
      });

      // Add OrbitControls so that we can pan around with the mouse.
      controls = new THREE.OrbitControls(camera, renderer.domElement);

    }


    // Renders the scene and updates the render as needed.
    function animate() {
  
      // Read more about requestAnimationFrame at http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
      requestAnimationFrame(animate);
      // Render the scene.
      renderer.render(scene, camera);
      controls.update();
      animateCar();
    }
    
    function animateCar(){
      if(speed>0){
        if(keyboard.pressed("left")) { 
          car.rotation.y += 0.1*speed; 
          angle += 0.1*speed; 
      } 
      if(keyboard.pressed("right")) { 
          car.rotation.y -= 0.1*speed; 
          angle -= 0.1*speed; 
      } 
        //Going forward accelerating
        if(keyboard.pressed("up")) {
          speed += 0.08;  
          if(speed>1){
            speed=1;
          }
          car.position.z += Math.cos(angle)*speed; 
          car.position.x += Math.sin(angle)*speed;
        }
        //Going forward breaking
        else if(keyboard.pressed("down")) {
          speed -= 0.04;  
          if(speed<0){
            speed=0;
          }
          car.position.z += Math.cos(angle)*speed; 
          car.position.x += Math.sin(angle)*speed;
        }
        else{
          //Going forward on its own
          speed -=0.02;
          if(speed>0){
            car.position.z += Math.cos(angle)*speed; 
            car.position.x += Math.sin(angle)*speed;
          }
        }
        
      }
      else if(speed<0){
        if(keyboard.pressed("left")) { 
          car.rotation.y -= 0.1*(-speed); 
          angle -= 0.1*(-speed); 
      } 
      if(keyboard.pressed("right")) { 
          car.rotation.y += 0.1*(-speed); 
          angle += 0.1*(-speed); 
      } 
        if(keyboard.pressed("up")) {
          speed += 0.04;  
          if(speed>0){
            speed=0;
          }
          car.position.z += Math.cos(angle)*speed; 
          car.position.x += Math.sin(angle)*speed;
        }
        else if(keyboard.pressed("down")) {
          speed -= 0.08;  
          if(speed<-0.7){
            speed=-0.7;
          }
          car.position.z += Math.cos(angle)*speed; 
          car.position.x += Math.sin(angle)*speed;
        }
        else{
          //Going backwards on its own
          speed +=0.02;
          if(speed>0){
            speed=0;
          }
          car.position.z += Math.cos(angle)*speed; 
          car.position.x += Math.sin(angle)*speed;          
        }
      }
      else{
         if(keyboard.pressed("up")) { 
          //car.translateZ(Math.cos(angle));
          speed+=0.1;
          car.position.z += Math.cos(angle)*speed; 
          car.position.x += Math.sin(angle)*speed; 
      } 
      if(keyboard.pressed("down")) {
          speed-=0.1;
          car.position.z -= Math.cos(angle)*speed; 
          car.position.x -= Math.sin(angle)*speed; 
      }
      }
      /*
      if(keyboard.pressed("left")) { 
          car.rotation.y += 0.1; 
          angle += 0.1; 
      } 
      if(keyboard.pressed("right")) { 
          car.rotation.y -= 0.1; 
          angle -= 0.1; 
      } 
      if(keyboard.pressed("up")) { 
          //car.translateZ(Math.cos(angle));
          car.position.z += Math.cos(angle); 
          car.position.x += Math.sin(angle); 
      } 
      if(keyboard.pressed("down")) { 
          car.position.z -= Math.cos(angle); 
          car.position.x -= Math.sin(angle); 
      }*/
          }
  </script>

</body>
</html>
